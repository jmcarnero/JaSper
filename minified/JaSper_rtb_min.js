/*! JaSper v3.4 | (c) 2015 José M. Carnero (sargazos.net) | JaSper_rtb v1.2 */
"use strict";JaSper.extend(JaSper.langs,{es:{"Background Color":"Color de fondo",Bold:"Negrita","Center Align":"Centrado","Font Size":"Tamaño de fuente","Font Family":"Fuente","Font Format":"Formato de fuente","Foreground Color":"Color","Horizontal Rule":"Línea horizontal",Image:"Imagen","Indent Text":"Indentar",Italic:"Cursiva","Justify Align":"Justificar","Left Align":"Alinear izquierda",Link:"Enlace","Insert Ordered List":"Insertar lista numerada",Redo:"Rehacer","Remove Indent":"Quitar indentación","Remove Formatting":"Quitar formato","Right Align":"Alinear derecha","Strike Through":"Tachar","See code":"Ver código",Subscript:"Subíndice",Superscript:"Superíndice","Insert Unordered List":"Insertar lista",Underline:"Subrayar",Undo:"Deshacer",Unlink:"Quitar enlace","XHTML mode":"Modo XHTML"}}),JaSper.extend(JaSper.prototype,{colorPicker:function(){var e=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",t=JaSper.nodo.crear("div",{"class":"JaSper slide wrapper",innerHTML:'<div class="indicator"></div>'}),o=JaSper.nodo.crear("div",{"class":"JaSper picker wrapper",innerHTML:'<div class="indicator"></div>'});if("SVG"==e)document.namespaces.svg||document.namespaces.add("svg","urn:http://www.w3.org/2000/svg",""),JaSper.nodo.crear("div",{},t,[JaSper.nodo.crear("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",innerHTML:'<defs><linearGradient id="gradient-hsv" x1="0%" y1="100% x2="0%" y2="0%"><stop offset="0%" stop-color="#FF0000" stop-opacity="1" /><stop offset="13%" stop-color="#FF00FF" stop-opacity="1" /><stop offset="25%" stop-color="#8000FF" stop-opacity="1" /><stop offset="38%" stop-color="#0040FF" stop-opacity="1" /><stop offset="50%" stop-color="#00FFFF" stop-opacity="1" /><stop offset="63%" stop-color="#00FF40" stop-opacity="1" /><stop offset="75%" stop-color="#0BED00" stop-opacity="1" /><stop offset="88%" stop-color="#FFFF00" stop-opacity="1" /><stop offset="100%" stop-color="#FF0000" stop-opacity="1" /></linearGradient></defs><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-hsv)" />',style:"width:100%;height:100%"})]),JaSper.nodo.crear("div",{},o,[JaSper.nodo.crear("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",innerHTML:'<defs><linearGradient id="gradient-black" x1="0%" y1="100% x2="100%" y2="100%"><stop offset="100%" stop-color="#000000" stop-opacity="1" /><stop offset="100%" stop-color="#CC9A81" stop-opacity="0" /></linearGradient><linearGradient id="gradient-white" x1="0%" y1="100% x2="100%" y2="100%"><stop offset="100%" stop-color="#FFFFFF" stop-opacity="1" /><stop offset="100%" stop-color="#CC9A81" stop-opacity="0" /></linearGradient></defs><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-white)" /><rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-black)" />',style:"width:100%;height:100%"})]);else{if("VML"!=e)return JaSper.log("[JaSper::rtb.colorPicker] No se puede construir.",1),!1;document.namespaces.vml||document.namespaces.add("vml","urn:schemas-microsoft-com:vml","#default#VML"),JaSper.nodo.crear("div",{},t,[JaSper.nodo.crear("div",{innerHTML:'<vml:rect style="position:absolute;top:0;left:0;width:100%;height:100%" stroked="f" filled="t"><vml:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></vml:fill></vml:rect>',style:"position:relative;width:100%;height:100%"})]),JaSper.nodo.crear("div",{},o,[JaSper.nodo.crear("div",{innerHTML:'<vml:rect style="position:absolute;left:-1px;top:-1px;width:101%;height:101%" stroked="f" filled="t"><vml:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></vml:fill></vml:rect><vml:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t"><vml:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></vml:fill></vml:rect>',style:"position:relative;width:100%;height:100%"})])}},rtb:function(e){e=e||{};var t={backColor:{comando:"HiliteColor",css:null,nombre:JaSper._t("Background Color"),tags:[],tecla:""},bold:{comando:"Bold",css:{"font-weight":"bold"},nombre:JaSper._t("Bold"),tags:["B","STRONG"],tecla:"b"},center:{comando:"JustifyCenter",css:null,nombre:JaSper._t("Center Align"),tags:[],tecla:""},fontSize:{comando:"FontSize",css:null,nombre:JaSper._t("Font Size"),tags:[],tecla:""},fontFamily:{comando:"FontName",css:null,nombre:JaSper._t("Font Family"),tags:[],tecla:""},fontFormat:{comando:!1,css:null,nombre:JaSper._t("Font Format"),tags:[],tecla:""},foreColor:{comando:"ForeColor",css:null,nombre:JaSper._t("Foreground Color"),tags:[],tecla:""},hr:{comando:"InsertHorizontalRule",css:null,nombre:JaSper._t("Horizontal Rule"),tags:[],tecla:""},image:{comando:"InsertImage",css:null,nombre:JaSper._t("Image"),tags:!1,tecla:""},indent:{comando:"Indent",css:null,nombre:JaSper._t("Indent Text"),tags:[],tecla:""},italic:{comando:"Italic",css:{"font-style":"italic"},nombre:JaSper._t("Italic"),tags:["EM","I"],tecla:"i"},justify:{comando:"JustifyFull",css:null,nombre:JaSper._t("Justify Align"),tags:[],tecla:""},left:{comando:"JustifyLeft",css:null,nombre:JaSper._t("Left Align"),tags:[],tecla:""},link:{comando:!1,css:null,nombre:JaSper._t("Link"),tags:[],tecla:""},ol:{comando:"InsertOrderedList",css:null,nombre:JaSper._t("Insert Ordered List"),tags:["OL"],tecla:""},outdent:{comando:"Outdent",css:null,nombre:JaSper._t("Remove Indent"),tags:[],tecla:""},redo:{comando:"Redo",css:null,nombre:JaSper._t("Redo"),tags:[],tecla:""},removeFormat:{comando:"RemoveFormat",css:null,nombre:JaSper._t("Remove Formatting"),tags:[],tecla:""},right:{comando:"Justifyright",css:null,nombre:JaSper._t("Right Align"),tags:[],tecla:""},strikeThrough:{comando:"StrikeThrough",css:{"text-decoration":"line-through"},nombre:JaSper._t("Strike Through"),tags:[],tecla:""},subscript:{comando:"Subscript",css:null,nombre:JaSper._t("Subscript"),tags:["SUB"],tecla:""},superscript:{comando:"Superscript",css:null,nombre:JaSper._t("Superscript"),tags:["SUP"],tecla:""},ul:{comando:"InsertUnorderedList",css:null,nombre:JaSper._t("Insert Unordered List"),tags:["UL"],tecla:""},underline:{comando:"Underline",css:{"text-decoration":"underline"},nombre:JaSper._t("Underline"),tags:["U"],tecla:"u"},undo:{comando:"Undo",css:null,nombre:JaSper._t("Undo"),tags:[],tecla:""},unlink:{comando:!1,css:null,nombre:JaSper._t("Unlink"),tags:[],tecla:""},verCodigo:{comando:"f:JaSper.rtb.verCodigo",css:null,nombre:JaSper._t("See code"),tags:[],tecla:""},xhtml:{comando:!1,css:null,nombre:JaSper._t("XHTML mode"),tags:[],tecla:""}},o=e.botones||["bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","link","unlink","foreColor","backColor","undo","redo","removeFormat"];this.each(function(){if(!this.id)return JaSper.log("[JaSper::rtb] No se soportan elementos sin ID.",1),!1;var e=this,n=e.tagName?e.tagName.toLowerCase():"",r=e.type?e.type.toLowerCase():"",a="input"==n&&"text"==r?"value":"textarea"==n&&"textarea"==r?"value":!1;if(!a)return void JaSper.log("[JaSper::rtb] No se soportan elementos ["+this.toString()+"].",0);var i=JaSper.css.getStyle("width",this)||this.clientWidth,l=JaSper.css.getStyle("height",this)||this.clientHeight;this.style.display="none";var s=JaSper.nodo.crear("div",{id:this.id+"_rtb",className:"JaSper_rtb contenedor"});s.style.width=i+"px",s.style.minHeight=l+"px";var d=JaSper.nodo.crear("div",{id:this.id+"_rtb_div",className:"JaSper_rtb editable"});if(!(d.contentEditable="true")&&!(window.document.designMode="on"))return JaSper.log("[JaSper::rtb] No se puede poner el elemento ["+d.id+"] en modo editable.",1),!1;d.style.height=l-18+"px",d.innerHTML=this[a],d.innerHTML=""==d.innerHTML?"<br />":d.innerHTML,d.spellcheck||!1,d.styleWithCSS=!1;for(var c=JaSper.nodo.crear("div",{innerHTML:"",className:"JaSper_rtb toolbar"}),p=0;p<o.length;p++){var m=t[o[p]];if(m.comando){var u='<div class="JaSper_rtb button '+o[p]+'" title="'+m.nombre+'" ';u+=-1!==m.comando.indexOf("f:")?"onmousedown=\"JaSper.rtb.command('"+d.id+"', "+m.comando.substr(2)+', null);return false;">':"onmousedown=\"JaSper.rtb.command('"+d.id+"', '"+m.comando+"', null);return false;\">",u+=m.tecla||"&nbsp;",u+="</div>",c.innerHTML+=u}}s.appendChild(c),s.appendChild(d),JaSper.event.add(d,"blur",function(){e[a]=this.innerHTML}),JaSper.event.add(e,"blur",function(){d.innerHTML=e[a]}),this.parentNode.insertBefore(s,this.nextSibling),s.insertBefore(this,c.nextSibling)})}}),JaSper.rtb={},JaSper.extend(JaSper.rtb,{command:function(e,t,o){if(o=o||null,"function"==typeof t)t.call(document.getElementById(e));else try{return document.execCommand(t,!1,o)}catch(n){return JaSper.log("[JaSper::rtb.command] No se puede ejecutar el comando ["+t+"] en el elemento ["+e+"].",1),!1}},seleccion:function(e,t,o,n){var r=window.getSelection();if(e){var a=document.createRange();x=e.compareDocumentPosition(t),4==x||0==x&&n>o?(a.setStart(e,o),a.setEnd(t,n)):(a.setStart(t,n),a.setEnd(e,o)),r.removeAllRanges(),r.addRange(a)}else var e=r.anchorNode,t=r.focusNode,o=r.anchorOffset,n=r.focusOffset;return{nodoIni:e,nodoFin:t,selIni:o,selFin:n}},verCodigo:function(){var e=document.getElementById(this.id.substr(0,this.id.indexOf("_rtb_div"))),t=e.style.display,o=e.tagName?e.tagName.toLowerCase():"",n=e.type?e.type.toLowerCase():"",r="input"==o&&"text"==n?"value":"textarea"==o&&"textarea"==n?"value":!1;"none"==t?(e[r]=this.innerHTML,this.style.display=e.style.display,e.style.display="block"):(this.innerHTML=e[r],e.style.display=this.style.display,this.style.display="block")}}),function(){function e(e,t){do if(3==e.nodeType){var o=e.nodeValue;if(!(t.length>0&&0===t.indexOf(o)&&t!==o))return{node:e,offset:t.length};t=t.substring(o.length)}else if(1===e.nodeType){var n=document.body.createTextRange();n.moveToElementText(e),t=t.substring(n.text.length)}while(e=e.nextSibling);return null}function t(t,o){if(!t)return null;var n=t.duplicate(),r=t.duplicate();n.collapse(o);var a=n.parentElement();return a instanceof HTMLInputElement?null:(r.moveToElementText(a),r.setEndPoint("EndToEnd",n),e(a.firstChild,r.text))}function o(){var e=window.document.selection.createRange(),o=t(e,!0),n=t(e,!1);return o&&n?{commonAncestorContainer:e.parentElement(),startContainer:o.node,startOffset:o.offset,endContainer:n.node,endOffset:n.offset}:null}!window.getSelection&&window.document.selection&&(window.getSelection=function(){var e=o();return{rangeCount:e?1:0,getRangeAt:function(){return e}}})}();
