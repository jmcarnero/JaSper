/*! JaSper v3.5 | (c) 2015 José M. Carnero (sargazos.net) | JaSper_rtb v1.3 */
JaSper.extend(JaSper.langs,{es:{"Background Color":"Color de fondo",Bold:"Negrita","Center Align":"Centrado",Copy:"Copiar",Cut:"Cortar","Font Size":"Tamaño de fuente","Font Family":"Fuente","Font Format":"Formato de fuente","Foreground Color":"Color","Horizontal Rule":"Línea horizontal",Image:"Imagen","Indent Text":"Indentar","Insert Ordered List":"Insertar lista numerada",Italic:"Cursiva","Justify Align":"Justificar","Left Align":"Alinear izquierda",Link:"Enlace",Paste:"Pegar",Redo:"Rehacer","Remove Indent":"Quitar indentación","Remove Formatting":"Quitar formato","Right Align":"Alinear derecha","Strike Through":"Tachar","See code":"Ver código",Subscript:"Subíndice",Superscript:"Superíndice","Insert Unordered List":"Insertar lista",Underline:"Subrayar",Undo:"Deshacer",Unlink:"Quitar enlace","XHTML mode":"Modo XHTML"}}),JaSper.extend(JaSper.prototype,{colorPicker:function(){"use strict";var e=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",t=JaSper.nodo.crear("div",{class:"JaSper slide wrapper",innerHTML:'<div class="indicator">slide</div>'}),o=JaSper.nodo.crear("div",{class:"JaSper picker wrapper",innerHTML:'<div class="indicator">picker</div>'});if("SVG"==e)JaSper.nodo.crear("div",{},t,[JaSper.nodo.crear("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",style:"width:100%;height:100%;"},null,[JaSper.nodo.crear("defs",{},null,[JaSper.nodo.crear("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},null,[JaSper.nodo.crear("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg")],"http://www.w3.org/2000/svg")],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"},null,[],"http://www.w3.org/2000/svg")],"http://www.w3.org/2000/svg")]),JaSper.nodo.crear("div",{},o,[JaSper.nodo.crear("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",style:"width:100%;height:100%;"},null,[JaSper.nodo.crear("defs",{},null,[JaSper.nodo.crear("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},null,[JaSper.nodo.crear("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"},null,[],"http://www.w3.org/2000/svg")],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},null,[JaSper.nodo.crear("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"},null,[],"http://www.w3.org/2000/svg")],"http://www.w3.org/2000/svg")],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"},null,[],"http://www.w3.org/2000/svg"),JaSper.nodo.crear("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"},null,[],"http://www.w3.org/2000/svg")],"http://www.w3.org/2000/svg")]);else{if("VML"!=e)return JaSper.log("[JaSper::rtb.colorPicker] No se puede construir.",1),!1;document.namespaces.vml||document.namespaces.add("vml","urn:schemas-microsoft-com:vml","#default#VML"),JaSper.nodo.crear("div",{},t,[JaSper.nodo.crear("div",{innerHTML:'<vml:rect style="position:absolute;top:0;left:0;width:100%;height:100%" stroked="f" filled="t"><vml:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></vml:fill></vml:rect>',style:"position:relative;width:100%;height:100%;"})]),JaSper.nodo.crear("div",{},o,[JaSper.nodo.crear("div",{innerHTML:'<vml:rect style="position:absolute;left:-1px;top:-1px;width:101%;height:101%" stroked="f" filled="t"><vml:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></vml:fill></vml:rect><vml:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t"><vml:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></vml:fill></vml:rect>',style:"position:relative;width:100%;height:100%;"})])}this.each(function(){this.parentNode.appendChild(t),this.parentNode.appendChild(o)})},rtb:function(e){"use strict";e=e||{};var t={backColor:{comando:"HiliteColor",css:null,nombre:JaSper._t("Background Color"),tags:[],tecla:""},bold:{comando:"Bold",css:{"font-weight":"bold"},nombre:JaSper._t("Bold"),tags:["B","STRONG"],tecla:"b"},center:{comando:"JustifyCenter",css:null,nombre:JaSper._t("Center Align"),tags:[],tecla:""},fontSize:{comando:"FontSize",css:null,nombre:JaSper._t("Font Size"),tags:[],tecla:""},fontFamily:{comando:"FontName",css:null,nombre:JaSper._t("Font Family"),tags:[],tecla:""},fontFormat:{comando:!1,css:null,nombre:JaSper._t("Font Format"),tags:[],tecla:""},foreColor:{comando:"ForeColor",css:null,nombre:JaSper._t("Foreground Color"),tags:[],tecla:""},hr:{comando:"InsertHorizontalRule",css:null,nombre:JaSper._t("Horizontal Rule"),tags:[],tecla:""},image:{comando:"InsertImage",css:null,nombre:JaSper._t("Image"),tags:!1,tecla:""},indent:{comando:"Indent",css:null,nombre:JaSper._t("Indent Text"),tags:[],tecla:""},italic:{comando:"Italic",css:{"font-style":"italic"},nombre:JaSper._t("Italic"),tags:["EM","I"],tecla:"i"},justify:{comando:"JustifyFull",css:null,nombre:JaSper._t("Justify Align"),tags:[],tecla:""},left:{comando:"JustifyLeft",css:null,nombre:JaSper._t("Left Align"),tags:[],tecla:""},link:{comando:!1,css:null,nombre:JaSper._t("Link"),tags:[],tecla:""},ol:{comando:"InsertOrderedList",css:null,nombre:JaSper._t("Insert Ordered List"),tags:["OL"],tecla:""},outdent:{comando:"Outdent",css:null,nombre:JaSper._t("Remove Indent"),tags:[],tecla:""},redo:{comando:"Redo",css:null,nombre:JaSper._t("Redo"),tags:[],tecla:""},removeFormat:{comando:"RemoveFormat",css:null,nombre:JaSper._t("Remove Formatting"),tags:[],tecla:""},right:{comando:"Justifyright",css:null,nombre:JaSper._t("Right Align"),tags:[],tecla:""},strikeThrough:{comando:"StrikeThrough",css:{"text-decoration":"line-through"},nombre:JaSper._t("Strike Through"),tags:[],tecla:""},subscript:{comando:"Subscript",css:null,nombre:JaSper._t("Subscript"),tags:["SUB"],tecla:""},superscript:{comando:"Superscript",css:null,nombre:JaSper._t("Superscript"),tags:["SUP"],tecla:""},ul:{comando:"InsertUnorderedList",css:null,nombre:JaSper._t("Insert Unordered List"),tags:["UL"],tecla:""},underline:{comando:"Underline",css:{"text-decoration":"underline"},nombre:JaSper._t("Underline"),tags:["U"],tecla:"u"},undo:{comando:"Undo",css:null,nombre:JaSper._t("Undo"),tags:[],tecla:""},unlink:{comando:!1,css:null,nombre:JaSper._t("Unlink"),tags:[],tecla:""},verCodigo:{comando:"f:JaSper.rtb.verCodigo('rtbId');return false;",css:null,nombre:JaSper._t("See code"),tags:[],tecla:""},copy:{comando:"copy",css:null,nombre:JaSper._t("Copy"),tags:[],tecla:""},cut:{comando:"cut",css:null,nombre:JaSper._t("Cut"),tags:[],tecla:""},paste:{comando:"paste",css:null,nombre:JaSper._t("Paste"),tags:[],tecla:""},xhtml:{comando:!1,css:null,nombre:JaSper._t("XHTML mode"),tags:[],tecla:""}},o=e.botones||["bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","link","unlink","foreColor","backColor","undo","redo","removeFormat","copy","cut","paste","verCodigo"];if(e.custom)for(var r in e.custom)t[r]=e.custom[r];this.each(function(){if(!this.id)return JaSper.log("[JaSper::rtb] No se soportan elementos sin ID.",1),!1;var e=this,r=e.tagName?e.tagName.toLowerCase():"",n=e.type?e.type.toLowerCase():"",a="input"==r&&"text"==n?"value":"textarea"==r&&"textarea"==n&&"value";if(a){var l=JaSper.css.getStyle("width",this)||this.clientWidth,s=JaSper.css.getStyle("height",this)||this.clientHeight;this.style.display="none";var i=JaSper.nodo.crear("div",{id:this.id+"_rtb",className:"JaSper_rtb contenedor"});i.style.width=l+"px",i.style.minHeight=s+"px";var c=JaSper.nodo.crear("div",{id:this.id+"_rtb_div",className:"JaSper_rtb editable"});if(!(c.contentEditable="true")&&!(window.document.designMode="on"))return JaSper.log("[JaSper::rtb] No se puede poner el elemento ["+c.id+"] en modo editable.",1),!1;c.style.height=s-18+"px",c.innerHTML=""==this[a]?"<br />":this[a],c.spellcheck,c.styleWithCSS=!1;for(var d=JaSper.nodo.crear("div",{innerHTML:"",className:"JaSper_rtb toolbar"}),p=0;p<o.length;p++){var u=t[o[p]];if(u.comando){var m="",g="";-1!==u.comando.indexOf("f:")?g=(g=u.comando.substr(2)).replace("rtbId",c.id):(g="JaSper.rtb.command('"+c.id+"', '"+u.comando+"', null);return false;",JaSper.rtb.commandSupport(u.comando)||(m=" noSoporte"));var w='<div class="JaSper_rtb button '+o[p]+m+'" title="'+u.nombre+'" ';w+='onmousedown="'+g+'">',w+=u.tecla||"&nbsp;",w+="</div>",d.innerHTML+=w}}i.appendChild(d),i.appendChild(c),JaSper.event.add(c,"blur",function(){e[a]=this.innerHTML}),JaSper.event.add(e,"blur",function(){c.innerHTML=e[a]}),this.parentNode.insertBefore(i,this.nextSibling),i.insertBefore(this,d.nextSibling)}else JaSper.log("[JaSper::rtb] No se soportan elementos ["+this.toString()+"].",0)})}}),JaSper.rtb={command:function(e,t,o){"use strict";if(!JaSper.rtb.commandSupport(t))return JaSper.log("[JaSper::rtb.command] Comando ["+t+"] no soportado por el navegador.",1),!1;o=o||null;try{return JaSper.funcs.isFunction(t)?t.call(document.getElementById(e)):document.execCommand(t,!1,o)}catch(o){return JaSper.log("[JaSper::rtb.command] No se puede ejecutar el comando ["+t+"] en el elemento ["+e+"].",1),!1}},commandSupport:function(e){"use strict";return!!document.queryCommandSupported(e)},getSeleccion:function(){var e="",t=document.activeElement,o=t?t.tagName.toLowerCase():null;return"textarea"==o||"input"==o&&/^(?:text|search|password|tel|url)$/i.test(t.type)&&"number"==typeof t.selectionStart?e=t.value.slice(t.selectionStart,t.selectionEnd):window.getSelection?e=window.getSelection().toString():window.selection&&(e=document.selection.createRange().htmlText),e},seleccion:function(e,t,o,r){"use strict";var n=window.getSelection()||document.selection.createRange();if(e){var a=document.createRange();x=e.compareDocumentPosition(t),4==x||0==x&&o<r?(a.setStart(e,o),a.setEnd(t,r)):(a.setStart(t,r),a.setEnd(e,o)),n.removeAllRanges(),n.addRange(a)}else var e=n.anchorNode,t=n.focusNode,o=n.anchorOffset,r=n.focusOffset;return{nodoIni:e,nodoFin:t,selIni:o,selFin:r}},verCodigo:function(e){"use strict";var t=document.getElementById(e),o=document.getElementById(e.substr(0,e.indexOf("_rtb_div"))),r=o.style.display,n=o.tagName?o.tagName.toLowerCase():"",a=o.type?o.type.toLowerCase():"",l="input"==n&&"text"==a?"value":"textarea"==n&&"textarea"==a&&"value";"none"==r?(o[l]=t.innerHTML,t.style.display=o.style.display,o.style.display="block"):(t.innerHTML=o[l],o.style.display=t.style.display,t.style.display="block")}},function(){function e(e,t){do{if(3==e.nodeType){var o=e.nodeValue;if(!(t.length>0&&0===t.indexOf(o)&&t!==o))return{node:e,offset:t.length};t=t.substring(o.length)}else if(1===e.nodeType){var r=document.body.createTextRange();r.moveToElementText(e),t=t.substring(r.text.length)}}while(e=e.nextSibling);return null}function t(t,o){if(!t)return null;var r=t.duplicate(),n=t.duplicate();r.collapse(o);var a=r.parentElement();return a instanceof HTMLInputElement?null:(n.moveToElementText(a),n.setEndPoint("EndToEnd",r),e(a.firstChild,n.text))}function o(){var e=window.document.selection.createRange(),o=t(e,!0),r=t(e,!1);return o&&r?{commonAncestorContainer:e.parentElement(),startContainer:o.node,startOffset:o.offset,endContainer:r.node,endOffset:r.offset}:null}!window.getSelection&&window.document.selection&&(window.getSelection=function(){var e=o();return{rangeCount:e?1:0,getRangeAt:function(){return e}}})}();
